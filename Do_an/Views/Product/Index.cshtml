@model IEnumerable<Do_an.Data.Product>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- View Cart Start -->
<div id="backdrop" class="backdrop"></div>
<div class="side-cart-container">
    <div id="sidecart" class="sidecart">
        <div class="cart-header">
            <span id="close-btn">&times;</span>
            <h3 class="cart-title">Shopping Cart</h3>
            <div class="cart-count">
                <span id="cart-count">0</span>
            </div>
        </div>
        <div class="cart-items">
            <div class="prod">
                <div class="product-cart">
                    <ol style="list-style: none;">
                        <li class="d-flex">

                        </li>
                    </ol>
                </div>
            </div>
        </div>
        <div class="side-cart-bottom">
            <div class="sub-total">
                <span class="total-title float-left">Total:</span>
                <span class="total-price float-right" id="total-price">đ</span>
            </div>
            <div class="cart-actions">
                <a asp-action="Payment" asp-controller="User" class="button-checkout">Check Out</a>
            </div>
        </div>
    </div>
</div>
<!-- View Cart End -->

<div class="input-group w-100 mx-auto d-flex">
    <input id="searchInput" type="search" class="form-control p-3" placeholder="Từ khóa" aria-describedby="search-icon-1">
    <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
    <span id="mic-icon" class="input-group-text p-3">
        <i class="fa fa-microphone" style="cursor: pointer;"></i>
    </span>
</div>

<br>
<br>

<!-- Khu vực hiển thị danh sách sản phẩm -->
<div id="product-list" class="container-xxl py-5 px-0">
    @Html.Partial("_ProductListPartial", Model)
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    var searchInput = document.querySelector('#searchInput');
    var productList = document.querySelector('#product-list');
    var message = document.querySelector('#message');

    // Tích hợp nhận diện giọng nói
    var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
    var recognition = new SpeechRecognition();
    recognition.lang = 'vi-VN'; // Đặt ngôn ngữ tiếng Việt
    recognition.interimResults = false;

    recognition.onresult = function (event) {
        var lastResult = event.results.length - 1;
        var content = event.results[lastResult][0].transcript;
        content = content.replace(/\.$/, '');
        searchInput.value = content;
        performSearch(content); // Thực hiện tìm kiếm sau khi nhận diện giọng nói hoàn tất
    };

    recognition.onspeechend = function () {
        recognition.stop();
    };

    recognition.onerror = function (event) {
        message.textContent = 'Error occurred in recognition: ' + event.error;
    };

    document.querySelector('#mic-icon').addEventListener('click', function () {
        recognition.start();
    });

    // Hàm tìm kiếm và hiển thị kết quả qua AJAX
    function performSearch(query) {
        $.ajax({
            type: "POST",
            url: "@Url.Action("Search", "Product")",
            data: { query: query },
            success: function (data) {
                productList.innerHTML = data;
            }
        });
    }

    // Thêm sự kiện click và Enter để thực hiện tìm kiếm
    document.querySelector('#search-icon-1').addEventListener('click', function () {
        performSearch(searchInput.value);
    });

    searchInput.addEventListener('keypress', function (event) {
        if (event.key === 'Enter') {
            performSearch(searchInput.value);
        }
    });
</script>
<script src="~/js/cart.js"></script>


<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
